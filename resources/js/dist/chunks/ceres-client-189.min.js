"use strict";(self.webpackChunkWaldorfshop7=self.webpackChunkWaldorfshop7||[]).push([[189],{4977:function(t,e,s){s.d(e,{y:function(){return l}}),s(3792),s(2953);const a=["btn-sm","btn-lg"],i={sm:"btn-sm",md:"",lg:"btn-lg"},l={props:{buttonSize:{type:[String,null],default:null,validator:t=>-1!==["",...a,...Object.keys(i)].indexOf(t)}},computed:{buttonSizeClass(){return i.hasOwnProperty(this.buttonSize)?i[this.buttonSize]:this.buttonSize}}}},2189:function(t,e,s){s.r(e),s.d(e,{default:function(){return c}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-pwd-reset"},[e("form",{ref:"loginForm",attrs:{id:"login-form-"+t._uid,method:"post"}},[e("div",{class:{"modal-body":t.modalElement}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("div",{staticClass:"input-unit",attrs:{"data-validate":"mail"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],attrs:{"data-testing":"email-login",type:"email",name:"email",autocomplete:"email",id:"email"+t._uid,"data-autofocus":""},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}}),t._v(" "),e("label",{attrs:{for:"email"+t._uid}},[t._v(t._s(t.$translate("Ceres::Template.loginEmail"))+"*")])]),t._v(" "),e("span",{staticClass:"error-msg"},[t._v(t._s(t.$translate("Ceres::Template.loginEnterConfirmEmail")))])]),t._v(" "),e("div",{staticClass:"col-12"},[e("div",{staticClass:"input-unit",class:{"no-bottom":t.modalElement},attrs:{"data-validate":"text"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{"data-testing":"password-login",type:"password",name:"password",autocomplete:"current-password",id:"password"+t._uid},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),t._v(" "),e("label",{attrs:{for:"password"+t._uid}},[t._v(t._s(t.$translate("Ceres::Template.loginPassword"))+"*")])]),t._v(" "),e("span",{staticClass:"error-msg"},[t._v(t._s(t.$translate("Ceres::Template.loginEmptyPassword")))])])])]),t._v(" "),e("div",{class:{"modal-footer":t.modalElement}},[e("div",{staticClass:"w-100"},[e("div",{staticClass:"row justify-content-between flex-column flex-lg-row"},[e("div",{staticClass:"col"},[e("a",{staticClass:"small text-appearance",attrs:{href:"javascript:void(0)"},on:{click:t.showResetPwdView}},[t._v(t._s(t.$translate("Ceres::Template.loginForgotPassword"))+"?")])]),t._v(" "),e("div",{staticClass:"col d-flex justify-content-between"},[t._t("extend-overlay-buttons"),t._v(" "),e("button",{staticClass:"btn btn-primary btn-appearance btn-medium",class:[{"float-right":!t.modalElement},t.buttonSizeClass],attrs:{"data-testing":"submit-login",disabled:t.isDisabled},on:{click:function(e){return e.preventDefault(),t.validateLogin.apply(null,arguments)}}},[t._v("\n                            "+t._s(t.$translate("Ceres::Template.login"))+"\n                            "),e("icon",{attrs:{icon:"user",loading:t.isDisabled}})],1)],2)])]),t._v(" "),t.modalElement?e("div",{staticClass:"w-100 text-center"},[e("hr"),t._v(" "),e("div",[t._v(t._s(t.$translate("Waldorfshop7::Template.noAccountYet")))]),t._v(" "),e("a",{staticClass:"btn btn-outline-primary",attrs:{href:t.urlRegistration}},[e("i",{staticClass:"fa fa-user-plus ml-1",attrs:{"aria-hidden":"true"}}),t._v(t._s(t.$translate("Ceres::Template.regRegisterAccount"))+"\n                ")])]):t._e()])])])};a._withStripped=!0;var i=s(4977),l=s(8115),o=s(7472),r=s(2280),n=s(9820),d=s(8520),u=s(1900),m={mixins:[i.y],props:{backlink:{type:String},modalElement:{type:String},hasToForward:{type:Boolean,default:!1}},data(){return{password:"",username:"",loginFields:[],isDisabled:!1}},mounted(){this.$nextTick((()=>{this.loginFields=this.$refs.loginForm.querySelectorAll(".input-unit"),n.default.triggerAutoFocus()}))},watch:{password(t,e){this.resetError()},username(t,e){this.resetError()}},computed:{urlRegistration(){return App.urls.registration}},methods:{showLogin(){r.default.findModal(document.getElementById(this.modalElement)).show()},validateLogin(){d.Ay.validate($("#login-form-"+this._uid)).done((()=>{this.sendLogin()})).fail((t=>{d.Ay.markInvalidFields(t,"error")}))},sendLogin(){this.isDisabled=!0,l.default.post("/rest/io/customer/login",{email:this.username,password:this.password},{supressNotifications:!0}).done((t=>{l.default.setToken(t),o.default.success(this.$translate("Ceres::Template.loginSuccessful")).closeAfter(3e3),null!==this.backlink&&this.backlink?location.assign(decodeURIComponent(this.backlink)):this.hasToForward?location.assign(location.origin):location.reload()})).fail((t=>{if(this.isDisabled=!1,401===t.error.code){this.loginFields.forEach((t=>t.classList.add("has-login-error")));let e="Ceres::Template.loginFailed";t.error.message.length>0&&"user is blocked"===t.error.message&&(e="Ceres::Template.loginBlocked"),o.default.error(this.$translate(e)).closeAfter(1e4)}}))},showResetPwdView(){this.resetError(),this.$store.dispatch("loadComponent","forgot-password-modal"),Vue.nextTick((()=>{let t=document.querySelector("#resetPwd");(0,u.GP)(t).$data.username=this.username;let e=()=>r.default.findModal(t).show();this.modalElement?r.default.findModal(document.getElementById(this.modalElement)).hide().then(e):e()}))},resetError(){this.loginFields.forEach((t=>t.classList.remove("has-login-error"))),d.Ay.unmarkAllFields("#login-form-"+this._uid)}}},c=(0,s(4486).A)(m,a,[],!1,null,null,null).exports}}]);
//# sourceMappingURL=ceres-client-189.min.js.map